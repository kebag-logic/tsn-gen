#Description of primitives and functions

#TODO add information for dependencies
# Sucha s controller or not controoler 
# Such as stream info sink/source
# Such as ptp etc...
# Generate the dependency such as 1722_1::protocol::vars::var_name

type: protocol
service: atdecc_adp_service

# Keep the message in the order they would arrive for pdu, defined the PDU
vars:
  - var: message_type
    size: 4  # Type of message (e.g., control, data)
    expected: 
      values: [ 0, 1, 2 ]
  - var: valid_time
    size: 5  # Time validity window (e.g., in TSN)
    expected:
      range: [ 1, 31 ]
      steps: 1
  - var: control_data_length
    size: 11  # Length of control data payload
      value: 56  
  - var: entity_id
    size: 64  # Unique identifier for the entity
    expected:
      not:
        exact: [ 0xFFFFFFFFFFFFFFFF, 0x0000000000000000 ]
  - var: entity_model_id
    size: 64  # Model identifier (e.g., hardware/software version)
  - var: entity_capabilities
    size: 32  # Bitmask of entity capabilities
  - var: talker_stream_sources
    size: 16  # Number of talker stream sources
  - var: talker_capabilities
    size: 16  # Capabilities of talker streams
      mask: [ 0x803F ]
  - var: listener_stream_sinks
    size: 16  # Number of listener stream sinks
  - var: listener_capabilities
    size: 16  # Capabilities of listener sinks
    expected:
      mask: [ 0x803F ]
  - var: controller_capabilities
    size: 32  # Bitmask of controller capabilities
    expected:
      mask: [ 0x8000 ]
  - var: available_index
    size: 32  # Index for available resources or configurations
    expected:
      values: [ 0, 1 ] 
  - var: gptp_grandmaster_id
    size: 64  # Identifier for the gPTP grandmaster clock
  - var: gptp_domain_number
    size: 8  # Domain number for gPTP synchronization
  - var: reserved0
    size: 8  # Reserved for future use
    expected:
      value: 0
  - var: current_configuration_index
    size: 16  # Index of the current configuration
  - var: identify_control_index
    size: 16  # Index for control identification
  - var: interface_index
    size: 16  # Index of the network interface
  - var: association_id
    size: 64  # Identifier for associations (e.g., TSN streams)
  - var: reserved1
    size: 32  # Reserved for future use
    expected:
      value: 0

message:
  - var: message_type
  - var: valid_time
  - var: control_data_length
  - var: entity_id
  - var: entity_model_id
  - var: entity_capabilities
  - var: talker_stream_sources
  - var: talker_capabilities
  - var: listener_stream_sinks
  - var: listener_capabilities
  - var: controller_capabilities
  - var: available_index
  - var: gptp_grandmaster_id
  - var: gptp_domain_number
  - var: reserved0
  - var: current_configuration_index
  - var: identify_control_index
  - var: interface_index
  - var: association_id
  - var: reserved1

typedefs:
  - typedef: entityInfoTypeDef
    type: structure
    vars:
      - var: valid_time
      - var: control_data_length
      - var: entity_id
      - var: entity_model_id
      - var: entity_capabilities
      - var: talker_stream_sources
      - var: talker_capabilities
      - var: listener_stream_sinks
      - var: listener_capabilities
      - var: controller_capabilities
      - var: available_index
      - var: gptp_grandmaster_id
      - var: gptp_domain_number
      - var: current_configuration_index
      - var: identify_control_index
      - var: interface_index
      - var: association_id
  - typedef: advertiseEntityFSMEnum
    type: enum
    size: 8
    vars: 
     - INITIALIZE: 0
     - DELAY: 1
     - ADVERTISE : 2
     - WAITING: 3
  - typedef: advertiseInterfaceFSMEnum
    type: enum
    size: 8
    vars: 
     - INITIALIZE: 0
     - WAITING: 1 
     - DEPARTING: 2
     - ADVERTISE : 3
  - typedef: discoverEntityFSMEnum
    type: enum
    size: 8
    vars: 
     - WAITING: 0
     - DISCOVER: 1 
     - AVAILABLE: 2
     - DEPARTING: 3
     - TIMEOUT : 4
  - typedef: discoverInterfaceFSMEnum
    type: enum
    size: 8
    vars: 
     - INITIALIZE: 0
     - WAITING: 1 
     - RECEIVED_DISCOVER: 2
     - UPDATE_GM: 3
     - LINK_STATE_CHANGE : 4
     - UPDATE_CONFIGURATION : 5

# Global variable shared amongst different block internally and externally
#global:
#  vars:
#    - var: curentTime
#      size: 64
#      dir: in
#    - var: entityInfo
#      type: entityInfoTypeDef
#      dir: inout
#    - var: reannounceTimerTimeout
#      dir: out
#    - var: needsAdvertise
#      type: boolean
#      dir: out
#    - var: doTerminate
#      type: boolean
#      dir: out
#    - var: delayTimerTimeout
#      dir: out

# Entities that can be in the ADP service
entities:
  - entity: ADP_INTERFACE
    interfaces:
      # Connection with the lower level interfaces
      - interface: ADP_IF_DATA
        dir: in
      # Connection with Date link layer to get info such as PTP link up mac aet
      - interface: ADP_DLL_INFO
        dir: in
      - interface: ADP_ENT_IF_DATA # Connection with the entity interfacing
        dir: out
    introspection:
      interfaces: 
        - ADP_IF_ADVERTIS_INTROSPECTION
        - ADP_IF_ANNOUNCE_INTROSPECTION
  entity: ADP_ENTITY
    interfaces:
      - ADP_ENTITY_INTERFACE
    introspection:
      interfaces: 
        - ADP_ENTITY_ADVERTISE_INTROSPECTION
        - ADP_ENTITY_ANNOUNCE_INTROSPECTION

documentation:
  - origin: "IEEE"
    name: "IEEE Std 1722-1-2021"
    section: [ "6" ]
